/*!
 * stepviz 0.1.0 (23-05-2016)
 * https://github.com/suhaibkhan/stepviz
 * MIT licensed

 * Copyright (C) 2016 Suhaib Khan, http://suhaibkhan.github.io
 */
!function(){"use strict";if("undefined"==typeof window.d3)throw"d3 library not found.";var a={};a.components={},a.constants={},window.stepViz=a}(),function(a){"use strict";a.config={},a.config.themeCSSClass="default",a.config.highlightCSSClass="highlight",a.config.defaultFontSize="12px"}(window.stepViz),function(a){"use strict";a.init=function(b,c){return new a.components.Board(b,c)}}(window.stepViz),function(a){"use strict";function b(a,b){var c=parseFloat(a);if(isNaN(c))throw"Invalid layout value "+a;return"string"==typeof a&&(a=a.trim(),a.endsWith("%")&&(c=c/100*b)),c}a.Layout=function(a,b,c){this._parent=a,this._box={top:0,left:0,width:"auto",height:"auto"},this._margin={top:0,left:0,bottom:0,right:0},this.setBox(b,c)},a.Layout.prototype.reCalculate=function(){var a={width:0,height:0};if(this._parent instanceof HTMLElement)a.width=this._parent.offsetWidth,a.height=this._parent.offsetHeight;else{if("function"!=typeof this._parent.getLayout)throw"Invalid parent";var c=this._parent.getLayout().getBounds();a.width=c.width,a.height=c.height}this._top=b(this._box.top,a.height),this._left=b(this._box.left,a.width),"auto"==this._box.width?this._width=a.width-this._left:this._width=b(this._box.width,a.width),"auto"==this._box.height?this._height=a.height-this._top:this._height=b(this._box.height,a.height)},a.Layout.prototype.setBox=function(b,c){this._box=a.util.defaults(b,this._box),this._margin=a.util.defaults(c,this._margin),this.reCalculate()},a.Layout.prototype.getBounds=function(){return{top:this._top,left:this._left,width:this._width,height:this._height}},a.Layout.prototype.getBox=function(){return{top:this._top+this._margin.top,left:this._left+this._margin.left,width:this._width-this._margin.left-this._margin.right,height:this._height-this._margin.top-this._margin.bottom}},a.Layout.prototype.moveTo=function(a,b){this._top=b,this._left=a},a.Layout.prototype.translate=function(a,b){this._top+=b,this._left+=a},a.Layout.prototype.clone=function(){return new a.Layout(this._parent,a.util.objClone(this._box),a.util.objClone(this._margin))}}(window.stepViz),function(a){"use strict";a.util={},a.util.defaults=function(a,b){a=a||{};for(var c in b)b.hasOwnProperty(c)&&!a.hasOwnProperty(c)&&(a[c]=b[c]);return a},a.util.objClone=function(b){var c=null;if(Array.isArray(b)){c=[];for(var d=0;d<b.length;d++)c.push(a.util.objClone(b[d]))}else if("object"==typeof b){c={};for(var e in b)b.hasOwnProperty(e)&&(c[e]=a.util.objClone(b[e]))}else c=b;return c},a.util.createTaskForPromise=function(a,b,c){return function(){return a.apply(b,c)}}}(window.stepViz),function(a,b){"use strict";function c(b,c){var d=c.dir,e=c.layout.getBox(),f=c.value,g={};a.constants.ARRAYITEM_PROP_LIST.forEach(function(a){g[a]=c[a]});var h=0;h=d==a.constants.ARRAY_VERT_DIR?Math.floor(e.height/f.length):Math.floor(e.width/f.length);for(var i=0,j=0,k=0;k<f.length;k++){var l={top:j,left:i,width:0,height:0};if(d==a.constants.ARRAY_VERT_DIR?(l.width=e.width,l.height=h,j+=h):(l.width=h,l.height=e.height,i+=h),c.children.length>k)c.children[k].updateLayout(l);else{var m=b.createLayout(l);b.drawArrayItem(f[k],m,a.util.objClone(g))}}}a.constants.ARRAY_CSS_CLASS="array",a.constants.ARRAY_HORZ_DIR="horizontal",a.constants.ARRAY_VERT_DIR="vertical",a.constants.ARRAY_ANIM_SWAP_PATH_AFTER="after",a.constants.ARRAY_ANIM_SWAP_PATH_BEFORE="before",a.constants.ARRAY_ANIM_SWAP_PATH_NONE="none",a.constants.ARRAY_PROP_LIST=["dir","fontSize","renderer"],a.components.Array=function(b,d,e,f){if(!Array.isArray(d))throw"Invalid array";if(0===d.length)throw"Empty array";if(!e)throw"Invalid layout";this._state=a.util.defaults(f,{dir:a.constants.ARRAY_HORZ_DIR,fontSize:a.config.defaultFontSize,renderer:function(a){return null===a?"":JSON.stringify(a)}}),this._state.value=d,this._state.layout=e;var g=e.getBox();this._state.parent=b,this._state.svgElem=b.svg().append("g").attr("class",a.constants.ARRAY_CSS_CLASS).attr("transform","translate("+g.left+","+g.top+")"),this._state.children=[],c(this,this._state)},a.components.Array.prototype.createLayout=function(b,c){return new a.Layout(this,b,c)},a.components.Array.prototype.drawArrayItem=function(b,c,d){var e=new a.components.ArrayItem(this,b,c,d);return this._state.children.push(e),e},a.components.Array.prototype.redraw=function(){this._state.layout.reCalculate(),c(this,this._state)},a.components.Array.prototype.svg=function(){return this._state.svgElem},a.components.Array.prototype.getLayout=function(){return this._state.layout},a.components.Array.prototype.updateLayout=function(a,b){return this._state.layout.setBox(a,b)},a.components.Array.prototype.highlight=function(a,b){if("number"==typeof a&&(a=[a]),!Array.isArray(a))throw"Invalid argument to highlight.";for(var c=0;c<a.length;c++){var d=a[c];d>-1&&d<this._state.children.length&&this._state.children[d].highlight(b)}},a.components.Array.prototype.unhighlight=function(a){if("number"==typeof a&&(a=[a]),!Array.isArray(a))throw"Invalid argument to unhighlight.";for(var b=0;b<a.length;b++){var c=a[b];c>-1&&c<this._state.children.length&&this._state.children[c].unhighlight()}},a.components.Array.prototype.translate=function(a,c,d){var e=this;return new Promise(function(f,g){d!==!1&&(d=!0),e._state.layout.translate(a,c);var h=e._state.svgElem,i=b.transform(h.attr("transform"));i.translate=[i.translate[0]+a,i.translate[1]+c],d?h.transition().attr("transform",i.toString()).each("end",f):(h.attr("transform",i.toString()),f())})},a.components.Array.prototype.clone=function(){var b=this._state,c={},d=["value","layout","parent","svgElem","children"];for(var e in b)b.hasOwnProperty(e)&&-1==d.indexOf(e)&&(c[e]=a.util.objClone(b[e]));return b.parent.drawArray(a.util.objClone(b.value),b.layout.clone(),c)},a.components.Array.prototype.swap=function(c,d,e,f){if(e!==!1&&(e=!0),f=a.util.defaults(f,{iDir:a.constants.ARRAY_ANIM_SWAP_PATH_NONE,jDir:a.constants.ARRAY_ANIM_SWAP_PATH_AFTER}),c>-1&&d>-1&&c<this._state.length&&d<this._state.length&&c!=d){var g=this._state[c];this._state[c]=this._state[d],this._state[d]=g;var h=b.transform(this._state[d].elem.attr("transform")),i=b.transform(this._state[c].elem.attr("transform")),j=this._state[d].elem.node().getBBox(),k=this._state[c].elem.node().getBBox();this._state[c].elem.transition().duration(1e3).attr("transform","translate("+-(k.width+10)+","+i.translate[1]+")").attr("transform","translate("+-(k.width+10)+","+h.translate[1]+")").attr("transform","translate("+h.translate[0]+","+h.translate[1]+")"),this._state[d].elem.transition().duration(1e3).attr("transform","translate("+(j.width+10)+","+h.translate[1]+")").transition().attr("transform","translate("+(j.width+10)+","+i.translate[1]+")").transition().attr("transform","translate("+i.translate[0]+","+i.translate[1]+")")}}}(window.stepViz,window.d3),function(a,b){"use strict";function c(a){var b=a.svgElem,c=a.layout.getBox(),e=a.value,f=a.renderer,g=a.fontSize,h=b.append("rect").attr("x",0).attr("y",0).attr("width",c.width).attr("height",c.height),i=b.append("text").text(f(e)).attr("x",0).attr("y",0).style("font-size",g),j=h.node().getBBox(),k=i.node().getBBox();i.attr("dx",(j.width-k.width)/2),i.attr("dy",(j.height-k.height)/2),d(a)}function d(b,c){c=c||{};var d=b.svgElem,e=d.attr("class");if(b.highlight){-1==e.indexOf(a.config.highlightCSSClass)&&(e+=" "+a.config.highlightCSSClass);for(var f in c)c.hasOwnProperty(f)&&(f.startsWith("rect-")?d.select("rect").style(f.substring(5),c[f]):f.startsWith("text-")&&d.select("text").style(f.substring(5),c[f]))}else e=e.replace(a.config.highlightCSSClass,"");d.attr("class",e)}a.constants.ARRAYITEM_CSS_CLASS="arrayItem",a.constants.ARRAYITEM_PROP_LIST=["fontSize","renderer"],a.components.ArrayItem=function(b,d,e,f){if("undefined"==typeof d)throw"Invalid value";if(!e)throw"Invalid layout";this._state=a.util.defaults(f,{fontSize:a.config.defaultFontSize,renderer:function(a){return null===a?"":JSON.stringify(a)}}),this._state.value=d,this._state.layout=e;var g=e.getBox();this._state.parent=b,this._state.svgElem=b.svg().append("g").attr("class",a.constants.ARRAYITEM_CSS_CLASS).attr("transform","translate("+g.left+","+g.top+")"),c(this._state)},a.components.ArrayItem.prototype.redraw=function(){if(!this._state||!this._state.svgElem)throw"ArrayItem redraw error - Invalid state or SVG";this._state.svgElem.selectAll("*").remove(),this._state.layout.reCalculate(),c(this._state)},a.components.ArrayItem.prototype.svg=function(){return this._state.svgElem},a.components.ArrayItem.prototype.getLayout=function(){return this._state.layout},a.components.ArrayItem.prototype.updateLayout=function(a,b){return this._state.layout.setBox(a,b)},a.components.ArrayItem.prototype.highlight=function(a){this._state.highlight=!0,d(this._state,a)},a.components.ArrayItem.prototype.unhighlight=function(){this._state.highlight=!1,d(this._state)},a.components.ArrayItem.prototype.translate=function(a,c,d){var e=this;return new Promise(function(f,g){d!==!1&&(d=!0),e._state.layout.translate(a,c);var h=e._state.svgElem,i=b.transform(h.attr("transform"));i.translate=[i.translate[0]+a,i.translate[1]+c],d?h.transition().attr("transform",i.toString()).each("end",f):(h.attr("transform",i.toString()),f())})},a.components.ArrayItem.prototype.moveTo=function(a,c,d){var e=this;return new Promise(function(f,g){d!==!1&&(d=!0),e._state.layout.moveTo(a,c);var h=e._state.svgElem,i=b.transform(h.attr("transform"));i.translate=[a,c],d?h.transition().attr("transform",i.toString()).each("end",f):(h.attr("transform",i.toString()),f())})},a.components.ArrayItem.prototype.moveThroughPath=function(b){var c=[];if("string"!=typeof b)throw"Invalid path";for(var d=b.split(" "),e=0;e<d.length;e++){var f=d[e],g=f.charAt(0),h=!0;if("M"==g||"L"==g||g>="0"&&"9">=g){h="M"!=g,"M"!=g&&"L"!=g||(f=f.substring(1));var i=f.split(",").map(parseFloat);if(2==i.length){var j=a.util.createTaskForPromise(this.moveTo,this,[i[0],i[1],h]);c.push(j)}}}return c.reduce(function(a,b){return promise.then(b)},Promise.resolve())}}(window.stepViz,window.d3),function(a,b){"use strict";a.constants.MAIN_CSS_CLASS="stepViz",a.constants.BOARD_PROP_LIST=["margin"],a.components.Board=function(c,d){if("string"==typeof c)c=document.getElementById(c);else if(!(c instanceof HTMLElement))throw"Invalid container";this._state=a.util.defaults(d,{margin:{top:10,left:10,bottom:10,right:10}}),this._state.layout=new a.Layout(c,{},this._state.margin),this._state.parent=null;var e=this._state.layout.getBounds(),f=this._state.layout.getBox();this._state.svgElem=b.select(c).append("svg").attr("width",e.width).attr("height",e.height).append("g").attr("transform","translate("+f.left+","+f.top+")").attr("class",a.constants.MAIN_CSS_CLASS+" "+a.config.themeCSSClass),this._state.children=[]},a.components.Board.prototype.redraw=function(){this._state.layout.reCalculate();var a=this._state.layout.getBounds(),c=b.select(this._state.svgElem.node().parentNode);c.attr("width",a.width).attr("height",a.height);for(var d=0;d<this._state.children.length;d++)this._state.children[d].redraw()},a.components.Board.prototype.svg=function(){return this._state.svgElem},a.components.Board.prototype.getLayout=function(){return this._state.layout},a.components.Board.prototype.drawArray=function(b,c,d){var e=new a.components.Array(this,b,c,d);return this._state.children.push(e),e},a.components.Board.prototype.createLayout=function(b,c){return new a.Layout(this,b,c)}}(window.stepViz,window.d3),String.prototype.startsWith||(String.prototype.startsWith=function(a,b){return b=b||0,this.substr(b,a.length)===a}),String.prototype.endsWith||(String.prototype.endsWith=function(a,b){var c=this.toString();("number"!=typeof b||!isFinite(b)||Math.floor(b)!==b||b>c.length)&&(b=c.length),b-=a.length;var d=c.indexOf(a,b);return-1!==d&&d===b});